function getOriginURL(){var t=new URL(safari.application.activeBrowserWindow.activeTab.url);return window.product_url=t.origin,t.origin}function startPopup(t,e){item=t,unknownWebsite=e,$("body").html('<div id="navbar">'+showNavbar()+'</div><div id="content"></div>'),item.name=item.name.replace(/"/g,"''"),item.image=item.image.replace(/"/g,"''"),item.size=item.size.replace(/"/g,"''"),item.color=item.color.replace(/"/g,"''"),item.name=item.name.replace(/^\s+|\s+$|\s+(?=\s)/g,""),item.image=item.image.replace(/^\s+|\s+$|\s+(?=\s)/g,""),item.size=item.size.replace(/^\s+|\s+$|\s+(?=\s)/g,""),item.color=item.color.replace(/^\s+|\s+$|\s+(?=\s)/g,""),window.giftibly_token_string="Token "+localStorage.getItem("giftibly_token"),item.merchant_name&&""!=localStorage.getItem("giftibly_token")?($("#back-button").hide(),safari.extension.popovers[0].height=465,$.ajax({dataType:"json",url:site_name+"/api/v1/baskets/",type:"GET",headers:{Authorization:giftibly_token_string},success:function(t){window.basket_list=t.data,window.customer_name=t.header.customer_name,showItemFound(),$(".item_description video, .item_description script, .item_description style, .item_description button, .item_description img").remove(),$(".item_description").find("*").removeAttr("class").removeAttr("id"),$(".item_description p").each(function(){0==$(this).height()&&$(this).remove(),$(".item_description p:empty").remove()})},error:function(){console.log("Cannot get basket data")}})):""==localStorage.getItem("giftibly_token")||"null"==localStorage.getItem("giftibly_token")?(safari.extension.popovers[0].height=150,document.getElementById("content").innerHTML='<div id="item-upper-div"><div class="please_login"><p>We\'re sorry but you don\'t seem to be logged in.</p><p>Please <a href="'+site_name+'">login</a> to Giftibly to use the Gift Assistant</p></div></div>',$("#settings-button").hide()):(showItemNotFound(),$("#settings-button").hide(),"https://www.giftibly.com"==getOriginURL()?safari.extension.popovers[0].height=246:unknownWebsite&&(safari.extension.popovers[0].height=324))}function showItemFound(){$("#content").css({opacity:0}).slideDown(1e3).animate({opacity:1},{queue:!1,duration:500}),setTimeout(function(){window.content_height=$("#content").height()},600),currentView="item-found",$("#content").html('<div id="item-upper-div"><div class="loading" id="loading-icon"><i class="fa fa-refresh fa-spin fa-fw"></i></div><div id="img_container"><img id="item-image" title="'+item.name+'" src="'+item.image+'"><div id="img_mask"></div></div></div>'+getItemBottomDiv()),document.getElementById("item-image").onload=function(){$("#loading-icon").remove()},addBasketListeners()}function showItemNotFound(){currentView="item-not-found";var t='<div id="navbar">'+showNavbar()+'</div><div id="content"><div id="not-found-div">';if("https://www.giftibly.com"==getOriginURL())t+='<img src="../img/orange-logo.png" style="width:48px;" class="box_image"><p class="big-title">You\'re on Giftibly</p><p class="description">Checkout some other websites!</p><button class="exit_button" type="button">Exit</button>';else if(unknownWebsite){t+='<img src="../img/sad_box.png" class="box_image"><p class="big-title">We\'re Sorry</p><p class="description">We don\'t know this site yet...<br>Please click below and we will<br>add it to our system.</p><button class="report_button" type="button">Suggest Site</button>';var e="unknown_merchant"}else{t+='<img src="../img/sad_box.png" class="box_image"><p class="big-title">OOPS!</p><p class="description">Are you on a specific product page?</p><p>If so:</p><button class="report_button" type="button">Report Issue</button>';var e="not_product_page"}document.body.innerHTML=t,$(".exit_button").click(function(){safari.self.hide()}),$(".report_button").click(function(){$.ajax({url:site_name+"/api/v1/errors",type:"POST",headers:{Authorization:giftibly_token_string},data:{url:getOriginURL(),error_type:e},success:function(t){thankyou()},error:function(){console.log("Cannot send data")}})}),$("#content").hide().fadeIn()}function getItemBottomDiv(){return htmlCode='<div id="item-bottom-div"><p id="item-name" title="'+item.name+'">'+item.name+"</p>",""==item.size||""==item.color?htmlCode+='<div id="size_color_container"><span>'+item.size+"</span><span>"+item.color+"</span></div>":htmlCode+='<div id="size_color_container"><span class="size_color_padding">'+item.size+'</span><span class="size_color_padding">'+item.color+"</span></div>",htmlCode+='<p id="item-price">'+item.price+'</p><div class="item_description">'+item.description+'</div> </div><p id="basket-label">Choose Gift Basket</p><i class="fa fa-search" aria-hidden="true"></i><input id="input-search" placeholder="Search"><div id="basket-div">'+getBasketDiv(getBasketList())+'</div><div id="new-basket-button"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-shopping-basket"></i></span>Create New Basket</div>',htmlCode}function getBasketDiv(t){var e="";if(t.length>0){e="<ul>";for(var i=0;i<t.length;i++)e+="<li><span>"+t[i].name+'</span><input class="save-button" data-basket="'+t[i].id+'" type="button" value="Add &#xF06B"></li>';e+="</ul>"}else e+="<p>No Basket Found</p>";return e}function getBasketList(){return basket_list}function addBasketListeners(t){for(var e=document.getElementsByClassName("save-button"),i=0;i<e.length;i++)e[i].addEventListener("click",function(t){return function(){save(e[t].parentNode.textContent,e[t].getAttribute("data-basket"))}}(i));$("#new-basket-button").on("click",function(){createBasket(),$("#back-button").hide(),$("#content").hide(),setTimeout(function(){$("#back-button").fadeIn()},400),$("#content").fadeIn()})}function save(t,e){var i=$(".item_description").html();$("#content").addClass("loading_content"),$("#content").html('<div class="loading_item" id="loading-icon"><i class="fa fa-refresh fa-spin fa-fw"></i></div>'),item.price=Number(100*item.price.replace(/[^0-9\.-]+/g,"")),item.price=Math.round(item.price),$.ajax({url:site_name+"/api/v1/baskets/add",type:"POST",headers:{Authorization:giftibly_token_string},data:{product_api_id:item.apiID,basket_id:e,price:item.price,title:item.name,merchant_url:getOriginURL(),product_url:getOriginURL(),merchant_name:item.merchant_name,color:item.color,size:item.size,description:i,product_image_url:item.image},success:function(e){window.response=JSON.stringify(e);var i=e.gift_id;$("#content").removeClass("loading_content"),response.indexOf("Successfully")>-1?(document.body.innerHTML='<div id="navbar">'+showNavbar(1)+'</div><div id="content"><div style="margin:10px;"><div id="img_container"><img id="success-item-image" title="'+item.name+'" src="'+item.image+'"><div id="success_img_mask"></div></div><p class="success-title">'+item.name+'</p><p class="big-description">Has been added to<br><b>'+t+'</b></p><div class="form_thank_you"><p class="tag-description">Add tags so your gift stands out.</p><input placeholder="tag1, tag 2, etc..." class="item-input" id="add-tag-form"><p class="thank_you_text">Thank you!</p><p class="more_items_text">Would you like to see more items like this?</p></div><div class="button_container"><button class="add_tags" type="button">Add Tags</button><button class="see_similar_button" type="button">See Similar Items</button></div></div></div>',$("#add-tag-form").keypress(function(t){13==t.which&&$(".add_tags").click()}),$(".add_tags").click(function(){if(""!=$("#add-tag-form").val()){var t=$("#add-tag-form").val();$.ajax({url:site_name+"/api/v1/gifts/add-tags",type:"POST",headers:{Authorization:giftibly_token_string},data:{gift_id:i,tags:t},success:function(t){},error:function(){console.log("Cannot get data")}}),$(this).fadeOut(300),$("#add-tag-form, .tag-description").fadeOut(300),setTimeout(function(){$(".see_similar_button, .thank_you_text, .more_items_text").fadeIn(600)},350)}}),$(".see_similar_button").click(function(){settingsCompareProduct(item)}),document.getElementById("back-button").onclick=function(t){startPopup(item),item.price="$"+(item.price/100).toFixed(2),$("#content").css("height",content_height+"px"),t.preventDefault()}):(safari.extension.popovers[0].height=292,document.body.innerHTML='<div id="navbar">'+showNavbar()+'</div><div id="content"><div id="not-found-div"><img src="../img/sad_box.png" class="box_image"><p class="big-title">OOPS!</p><p class="description">Something went wrong.</p><button class="report_button" type="button">Report Issue</button></div></div>',$("#settings-button").hide(),$(".report_button").click(function(){$.ajax({url:site_name+"/api/v1/errors",type:"POST",headers:{Authorization:giftibly_token_string},data:{url:getOriginURL(),error_type:"validation"},success:function(t){thankyou()},error:function(){console.log("Cannot send data")}})})),$("#content").hide().fadeIn()},error:function(){console.log("Cannot get data")}})}function createBasket(){safari.extension.popovers[0].height=316,document.body.innerHTML='<div id="navbar">'+showNavbar(1)+'</div><div id="content"><div style="margin:35px 10px 0 10px"><img src="../img/basket.jpg" class="basket_image"><input placeholder="Enter New Basket Name" class="item-input" maxlength="40" id="basket-name"><input id="create-basket-button" type="button" value="Create New"></div></div>',$("#create-basket-button").click(function(){var t=$("#basket-name").val();$.ajax({url:site_name+"/api/v1/baskets/create?name="+t,type:"GET",processData:!1,headers:{Authorization:giftibly_token_string},success:function(t){startPopup(item)},error:function(){console.log("Cannot get data")}})}),document.getElementById("back-button").onclick=function(t){startPopup(item),$("#content").css("height",content_height+"px"),t.preventDefault()}}function onSearch(){var t="(?:^|\\s)"+$(this).val(),e=0;$("#basket-div li").each(function(){$(this).text().search(new RegExp(t,"i"))<0?$(this).hide():($(this).show(),e++)})}var site_name="https://www.giftibly.com",global=safari.extension.globalPage.contentWindow,item,unknownWebsite;!function(){$(document).on("click","#settings-button",function(){showSettings()}),$(document).on("keyup","#input-search",onSearch)}();