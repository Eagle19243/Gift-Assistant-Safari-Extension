function postMessage(e,a){safari.application.activeBrowserWindow.activeTab&&safari.application.activeBrowserWindow.activeTab.page&&safari.application.activeBrowserWindow.activeTab.page.dispatchMessage(e,a)}function handleMessage(e){"from_injected"==e.name&&("loggin_status"==e.message.type?e.message.logged_in?(localStorage.setItem("giftibly_token",e.message.token),postMessage("from_global",{type:"loggin_status",logged_in:!0})):(localStorage.setItem("giftibly_token",""),postMessage("from_global",{type:"loggin_status",logged_in:!1})):"got_item"==e.message.type&&e.message.itemData&&(item=e.message.itemData,unknownWebsite=e.message.unknownWebsiteData,popover.startPopup(item,unknownWebsite)))}function popoverHandler(e){"popover"===e.target.identifier&&postMessage("from_global",{type:"got_item",action:"getItem"})}const popover=safari.extension.popovers[0].contentWindow;window.onload=function(){safari.application.addEventListener("message",handleMessage,!1),safari.application.addEventListener("popover",popoverHandler,!0)};